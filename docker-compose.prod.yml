# ============================================
# Docker Compose - Production (EC2)
# ============================================
# This file uses pre-built images from Docker Hub
# Usage: docker-compose -f docker-compose.prod.yml up -d
# ============================================

services:
  # ----------------
  # Frontend Service
  # ----------------
  frontend:
    image: ${IMAGE_FRONTEND:-your-dockerhub-username/project-tracker-frontend:latest}
    container_name: project-tracker-frontend
    ports:
      - "80:80"
    depends_on:
      - backend
    networks:
      - app-network
    restart: unless-stopped

  # ----------------
  # Backend Service
  # ----------------
  backend:
    image: ${IMAGE_BACKEND:-your-dockerhub-username/project-tracker-backend:latest}
    container_name: project-tracker-backend
    ports:
      - "8080:8080"
    environment:
      # Application Configuration
      - SPRING_APPLICATION_NAME=${APP_NAME:-Project Tracker}
      - APP_NAME=${APP_NAME:-Project Tracker}
      - APP_FRONTEND_URL=${FRONTEND_URL}

      # Server Configuration
      - SERVER_PORT=8080

      # Database Configuration (RDS MySQL)
      - SPRING_DATASOURCE_URL=${DB_URL}
      - SPRING_DATASOURCE_USERNAME=${DB_USERNAME}
      - SPRING_DATASOURCE_PASSWORD=${DB_PASSWORD}
      - SPRING_DATASOURCE_DRIVER_CLASS_NAME=com.mysql.cj.jdbc.Driver

      # JPA / Hibernate Settings
      - SPRING_JPA_HIBERNATE_DDL_AUTO=update
      - SPRING_JPA_SHOW_SQL=false
      - SPRING_JPA_PROPERTIES_HIBERNATE_FORMAT_SQL=false
      - SPRING_JPA_PROPERTIES_HIBERNATE_DIALECT=org.hibernate.dialect.MySQLDialect

      # JWT Configuration
      - JWT_SECRET=${JWT_SECRET}
      - JWT_EXPIRATION=${JWT_EXPIRATION:-7200000}

      # Email Configuration
      - SPRING_MAIL_HOST=${MAIL_HOST:-smtp.gmail.com}
      - SPRING_MAIL_PORT=${MAIL_PORT:-587}
      - SPRING_MAIL_USERNAME=${MAIL_USERNAME}
      - SPRING_MAIL_PASSWORD=${MAIL_PASSWORD}
      - SPRING_MAIL_PROPERTIES_MAIL_SMTP_AUTH=true
      - SPRING_MAIL_PROPERTIES_MAIL_SMTP_STARTTLS_ENABLE=true
      - SPRING_MAIL_PROPERTIES_MAIL_SMTP_STARTTLS_REQUIRED=true
      - SPRING_MAIL_PROPERTIES_MAIL_SMTP_CONNECTIONTIMEOUT=5000
      - SPRING_MAIL_PROPERTIES_MAIL_SMTP_TIMEOUT=5000
      - SPRING_MAIL_PROPERTIES_MAIL_SMTP_WRITETIMEOUT=5000

      # Logging Configuration (Production - less verbose)
      - LOGGING_LEVEL_ROOT=INFO
      - LOGGING_LEVEL_COM_EXAMPLE_DEMO=INFO
      - LOGGING_LEVEL_ORG_SPRINGFRAMEWORK_SECURITY=WARN
      - LOGGING_LEVEL_ORG_SPRINGFRAMEWORK_MAIL=WARN
    networks:
      - app-network
    restart: unless-stopped

# ----------------
# Networks
# ----------------
networks:
  app-network:
    driver: bridge